# 前端开发计划 - V5（Tag / RecycleBin / Proxy 真实联调交付）

> V5 目标：对齐 `docs/后端开发计划-V5.md`，把前端 **标签管理 / 窗口回收站 / 代理列表** 从“延期/演示/空数据”推进到“真实可用、可联调、可验收”。

---

## 1. 当前现状（前端侧）

### 1.1 已具备的前端资产

- 已有 API 封装：
  - `src/api/tagApi.ts`（调用 `get_tags/create_tag/update_tag/delete_tag`）
  - `src/api/recycleBinApi.ts`（调用 `get_recycle_bin/.../empty_recycle_bin`）
  - `src/api/proxyApi.ts`（调用 `get_proxies/create_proxy/update_proxy/delete_proxy`）
- 已有页面：
  - `src/features/tags/TagManagement.vue`（已按真实 API 编写）
  - `src/features/recycle/RecycleBin.vue`（已按真实 API 编写）
  - `src/features/proxy/ProxyManagement.vue`（已按真实 API 编写，但 `handleCheck` 仍是模拟）

### 1.2 当前阻塞（与后端 V5 完全一致）

- **Gate-BE-V5-IPC**：后端尚未将 Tag/RecycleBin/Proxy 的 IPC 命令接入 `lib.rs`（命令注册被注释）。
- **Gate-BE-V5-RB-deletedAt**：后端 `get_recycle_bin` 当前未返回 `deletedAt` 字段（前端目前用 `updatedAt` 代替，属于不正确口径）。
- **Gate-BE-V5-Proxy-Model**：
  - 当前后端存在 `proxy_templates`（settings JSON）实现，但 IPC 文档与产品 UI 需要的是 `proxies` 列表实体（含状态/检测/来源等）。
  - 后端 V5 建议升级为 `proxies` 表。

---

## 2. V5 交付定义（前端 Done Definition）

### 2.1 TagManagement（标签管理）

- [ ] 列表加载正常（含 `windowCount`）
- [ ] 新增/编辑/删除标签可用，错误提示可理解
- [ ] 搜索 + 分页正常

### 2.2 RecycleBin（窗口回收站）

- [ ] 回收站列表可加载，展示字段包含：窗口名/分组/备注/删除时间
- [ ] 单个恢复 / 单个永久删除 可用
- [ ] 批量恢复 / 批量永久删除 / 清空回收站 可用，并能展示批量结果（成功数/失败数/失败原因）

### 2.3 ProxyManagement（代理列表）

- [ ] 列表可加载（筛选：类型/来源/状态；搜索：host/ip）
- [ ] 新增/编辑/删除可用
- [ ] 检测代理：接入后端 `test_proxy`，展示检测结果（成功/失败 + 延迟/错误）

---

## 3. 依赖关口（Gate）

### Gate-BE-V5-IPC（P0）

- 后端注册并接入以下命令后，前端页面才能真实联调：
  - Tag：`get_tags/create_tag/update_tag/delete_tag`
  - RecycleBin：`get_recycle_bin/restore_profile/batch_restore_profiles/permanently_delete_profile/batch_permanently_delete_profiles/empty_recycle_bin`
  - Proxy：`get_proxies/get_proxy/create_proxy/update_proxy/delete_proxy/test_proxy`

### Gate-BE-V5-RB-deletedAt（P0）

- 后端 `get_recycle_bin` 必须返回 `deletedAt`（RFC3339），前端据此展示“删除时间”。

### Gate-BE-V5-Proxy-Model（P0/P1）

- 若后端按 V5 升级为 `proxies` 表：前端 ProxyManagement 的字段展示（source/tag/status/ipAddress/location/usedCount/expireAt）才能成立。

---

## 4. 任务拆解（按优先级）

### Phase FE-V5-0：对齐接口与模型（0.5 天，P0）

- **目标**：在后端 Gate 解锁前，先把前端“类型/字段/展示口径”统一。
- **任务**：
  - Tag：确认 `TagDto` 字段与后端一致（当前 `tagApi.ts` 使用 `window_count/created_at/updated_at`）
  - RecycleBin：
    - 将“删除时间”字段从 `updatedAt` 迁移为真实 `deletedAt`
    - 等待后端返回后再启用
  - Proxy：
    - 明确前端页面目前扩展字段（source/tag/ipAddress/location/status/expireAt）是目标态字段
    - 后端未实现前：页面应明确标识“部分字段待后端检测/返回”

### Phase FE-V5-1：TagManagement 真联调（0.5-1 天，P0）

- **目标**：标签列表 + CRUD 闭环。
- **任务**：
  - 页面层：`TagManagement.vue`
    - 成功后刷新列表（或本地更新）
    - 错误提示展示后端 error.message（如“标签名称已存在”）
  - （可选）事件：若后端增加 `tag:*` 事件，则前端监听并自动更新列表
- **验收**：
  - 新建/改名/删除均生效
  - windowCount 变化合理（至少不为 NaN/undefined）

### Phase FE-V5-2：RecycleBin 真联调（1-1.5 天，P0）

- **目标**：回收站列表 + 恢复/永久删除 + 批量结果可见。
- **任务**：
  - `RecycleBin.vue`：
    - `deletedAt` 字段使用后端返回值，不再用 `updatedAt` 兜底
    - 批量恢复/批量永久删除：
      - 当前仅 toast 总数，建议补齐“失败项原因展示”（可复用 `BatchResultDialog`）
    - `emptyRecycleBin`：返回删除数量，toast 显示“清空 N 条”
- **验收**：
  - delete_profile 后出现在回收站
  - restore 后从回收站消失并回到窗口列表
  - permanently delete 后不可恢复

### Phase FE-V5-3：ProxyManagement 真联调（1-2 天，P0/P1）

- **目标**：代理列表 CRUD + 检测代理。
- **任务**：
  - `ProxyManagement.vue`：
    - `handleCheck` 从模拟改为调用后端 `test_proxy`
    - 将检测结果落到 UI：status/latency/location/ipAddress（若后端提供）
  - API：补齐 `testProxy` 调用（当前 `proxyApi.ts` 没有封装该函数）
- **验收**：
  - 新增/编辑/删除后列表立即一致
  - 检测成功/失败提示可理解（显示 error）

---

## 5. 排期建议（单人前端）

- Day 0.5：Phase FE-V5-0（接口/字段对齐 + 目标态字段标识）
- Day 1：TagManagement（FE-V5-1）
- Day 2：RecycleBin（FE-V5-2）
- Day 3-4：ProxyManagement（FE-V5-3，含检测与字段展示）

合计：**3.5-5 天**（取决于 Proxy `test_proxy` 返回的字段丰富程度）。

---

## 6. 最终验收清单（V5）

- [ ] Tag：列表/CRUD/错误提示/窗口数统计正确
- [ ] RecycleBin：deletedAt 正确；恢复/永久删除/批量操作可用；结果可解释
- [ ] Proxy：列表/筛选/CRUD/检测可用；字段展示与后端返回一致
- [ ] 文档一致性：`docs/IPC-接口说明.md` 的命令与字段与实际实现一致
