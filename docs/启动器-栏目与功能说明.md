# 启动器（PC 端浏览器多开器）- 栏目与功能说明

> 本文档用于把“启动器”当前 UI 栏目与功能点做产品/研发/测试统一对齐。
> 
> 说明：本文以当前代码导航结构（`src/App.vue`）为准；并对每个栏目给出：
> 
> - 功能范围（做什么/不做什么）
> - 关键交互（用户能点什么）
> - 数据与依赖（Store/API/IPC/事件）
> - 关键验收点

---

## 1. 启动器导航栏目总览（当前版本）

当前应用采用“侧边栏 + 顶部栏 + 工作区”布局（`MainLayout.vue`），页面切换在 `App.vue` 中通过 `currentPage` 控制：

- `dashboard`：窗口列表（核心入口）
- `groups`：分组管理
- `recycle`：回收站
- `proxy`：代理管理
- `tags`：标签管理
- `settings`：系统设置

---

## 2. 核心栏目：窗口列表（Dashboard / 窗口管理）

### 2.1 栏目定位

- **定位**：启动器的主工作台，用于管理“窗口（Profile）”并进行启动/停止/批量操作。
- **入口**：默认首页（`currentPage = 'dashboard'`）。
- **主要页面**：`src/features/dashboard/DashboardView.vue`。

### 2.2 顶部统计区 / 筛选区 / 批量区（用户视角）

#### 2.2.1 统计信息

- **总数量**：共 N 个窗口（`profiles.length`）
- **运行中数量**：运行中 N 个（`runningCount`）
- **停止数量（目标态）**：已停止 N 个（`profiles.filter(p => p.status === 'stopped').length`）
- **异常数量（目标态）**：异常 N 个（`profiles.filter(p => p.status === 'error').length`）

> 现状说明：当前 UI 只展示“总数量 + 运行中数量”。停止/异常计数属于你提出的产品要求，建议在统计区补齐。

#### 2.2.2 筛选与搜索

- **状态筛选**：全部状态 / 运行中 / 已停止 / 异常（目标态，当前 UI 未提供“异常”选项）
- **分组筛选**：全部分组 + 分组下拉（当前 UI 已有下拉，但依赖 GroupStore 的真实数据；后端未实现时会走 mock fallback）
- **关键词搜索**：搜索窗口（当前 placeholder 仍为“搜索环境...”，建议后续统一为“搜索窗口”）

> 目标态建议：
>
> - 支持按“窗口名称/窗口ID/备注/代理 host”搜索（可逐步实现）

#### 2.2.3 批量操作

- **批量启动**：对选中的窗口执行启动
- **批量停止**：对选中的窗口执行停止
- **批量删除（规划）**：
  - 当前 Dashboard 已存在 store 的 `batchDeleteProfiles` 能力，但 UI 是否暴露按钮/入口取决于产品设计（建议：在批量区补齐“批量删除”并二次确认）。
- **批量结果展示**：
  - 当前前端已具备结果对话框 `BatchResultDialog`，并在存在失败项时弹窗；
  - 逐项失败原因的完整展示强依赖后端批量接口返回逐项结果（Gate-BE-Batch）。

> 目标态建议：批量操作至少应包含：
>
> - 成功数量 / 失败数量
> - 失败窗口列表（窗口名称 + ID + 失败原因）

#### 2.2.4 创建窗口入口

- **创建新窗口**：顶部/侧边栏触发“创建新窗口”（`MainLayout` emit `create-new` → `DashboardView.handleCreateNew()` → 打开抽屉）

### 2.3 窗口列表的“列表栏目/列定义”（产品/测试对齐）

> 以当前代码中的列表表头与行组件为准：
> 
> - 表头：`src/features/dashboard/components/ListHeader.vue`
> - 行：`src/features/dashboard/components/ProfileRow.vue`

#### 2.3.1 列表列（表头）

- **[勾选框]（已实现）**
  - 用于批量操作选择
- **[状态]（已实现）**
  - running / stopped / error（通过 `StatusDot` 展示）
- **[窗口名称/ID]（目标态）**
  - **窗口名称**：`profile.name`（已实现）
  - **窗口 ID**：`profile.id`（目标态）
    - 建议：名称下方第二行展示 ID + 复制按钮
  - **备注**：当前实现把 `profile.remark` 放在“名称”列的第二行显示；目标态可拆分为独立“备注”列（见下）。
- **[分组]（已实现）**
  - 当前展示：`profile.group || '默认'`
  - 注意：当前 Dashboard 里的“分组筛选下拉”使用的是 `group.id`，而 Profile 的 `group` 字段当前为 string（这部分需要在 Group 真联调后统一语义：存 groupId 还是 groupName）
- **[代理信息]（目标态）**
  - 当前实现：若存在 `profile.proxy`，展示 `host:port`；否则“无代理”
  - 目标态：
    - 展示：type/host/port（必要）
    - 可选补充：username（脱敏）、来源、标签、有效期、检测状态
- **[平台]（已实现）**
  - 来源：`profile.fingerprint.platform`（windows/macos/linux）
- **[备注]（目标态）**
  - 当前实现：备注显示在“名称”列第二行
  - 目标态：单独列展示 `remark`，便于排序/过滤（可选）
- **[更新时间]（已实现）**
  - 当前展示：`profile.updatedAt`
- **[操作]（部分已实现）**
  - 已实现：启动/停止 + 更多（编辑/删除）
  - 目标态：启动 / 修改配置 / 收藏 / 更多（见 2.4）

> 现状与目标差异总结：
>
> - 现状列为：状态 / 名称(含备注) / 分组 / 平台 / 代理 / 更新时间 / 操作
> - 目标态列为：状态 / 窗口名称/ID / 分组 / 代理信息 / 平台 / 备注 / 操作

#### 2.3.2 窗口列表字段明细（目标态 - 你要求的最终版本）

| 列/字段 | 展示内容 | 数据来源 | 实现状态 |
|---|---|---|---|
| 状态 | running / stopped / error（点/颜色） | `profile.status` | 已实现 |
| 窗口名称/ID | 名称 + ID（可复制） | `profile.name` / `profile.id` | 名称已实现；ID展示待补齐 |
| 分组 | 分组名称/默认 | `profile.group`（需统一语义：groupId vs groupName） | 部分实现（受 Gate-BE-Group 影响） |
| 代理信息 | type + host:port +（可选）来源/标签/状态 | `profile.proxy` | host:port 已实现；扩展字段待实现 |
| 平台 | windows/macos/linux + 图标 | `profile.fingerprint.platform` | 已实现 |
| 备注 | 备注文本 | `profile.remark` | 当前在名称列第二行；独立列待补齐 |
| 操作 | 启动/修改配置/收藏/更多 | UI 动作 + 后端 IPC | 部分实现（见 2.4） |

> 备注：当前代码表头列是固定的（见 `ListHeader.vue`），若要完全达到目标态，需要调整表头与行组件。

### 2.4 窗口列表的“操作区”（按钮与更多菜单）

#### 2.4.1 基础操作（当前已实现）

- **启动**
  - 当窗口状态 ≠ running 时显示
  - 规则：启动前检查 `kernel_path`，未设置则弹窗引导到 Settings
- **停止**
  - 当窗口状态 = running 时显示
- **编辑（修改配置）**
  - 打开“编辑窗口”抽屉
- **删除**
  - 二次确认后删除窗口

> 目标态补齐（你要求的操作模型）：
>
> - 操作列 = 启动 + 修改配置 + 收藏 + 更多

#### 2.4.2 收藏（规划）

- **收藏/取消收藏**：
  - 目的：将常用窗口置顶或作为筛选条件
  - 数据字段建议：`is_favorite:boolean` 或 `favorite_at`（需要后端字段与排序规则）
  - 建议交互：
    - 点击星标立即生效
    - 可在列表增加“仅看收藏”筛选

#### 2.4.3 更多菜单（产品清单，部分为规划待实现）

> 当前代码仅有“编辑/删除”。以下为你要求的“更多”菜单能力清单，建议统一作为一个窗口级能力菜单。
> 
> 每一项建议在产品层明确：是否仅对“已停止窗口”可用，是否允许批量，是否需要二次确认。

- **上传 Cookie / 上传cookie（规划）**
  - 输入：cookie 文件或 cookie 文本
  - 输出：导入结果（成功/失败原因）
  - 依赖：后端提供“向窗口数据目录写入 cookies”的能力，且明确加密与权限策略
  - 建议限制：优先要求窗口为“已停止”再允许导入（避免运行中数据竞争）
- **上传书签（规划）**
  - 输入：书签文件
  - 输出：导入结果（成功/失败原因）
  - 建议限制：窗口为“已停止”
- **下载书签（规划）**
  - 输出：书签文件导出
  - 建议限制：窗口为“已停止”（或明确支持运行中读取）
- **管理已保存密码（规划）**
  - 说明：涉及系统凭据/加密存储，必须明确安全策略与访问控制
  - 建议形态：独立弹窗/独立页面（避免在更多菜单里直接堆太多 UI）
- **清除缓存（规划）**
  - 作用范围：Cache（不含 Cookie）
  - 建议限制：窗口为“已停止”
- **清除缓存(保留插件及其数据)（规划）**
  - 作用范围：Cache + 保留 Extensions/扩展数据（需明确实现方式与路径白名单）
  - 建议限制：窗口为“已停止”
- **清除缓存及Cookie（规划）**
  - 作用范围：Cache + Cookies
  - 建议限制：窗口为“已停止”
- **随机重置指纹（规划，且与 Fingerprint 策略联动）**
  - 行为：对该窗口生成新的 fingerprint seed 或重置白名单字段
  - 依赖：前后端 Fingerprint merge/patch 策略闭环（Gate-FP）
  - 建议限制：窗口为“已停止”（避免运行中切换指纹产生不可控行为）
- **窗口转移（规划）**
  - 行为：将窗口从分组 A 移动到分组 B
  - 依赖：Group 真联调（Gate-BE-Group）
  - 建议交互：选择目标分组后立即生效（或支持批量转移）
- **删除（已实现）**

### 2.5 数据与依赖（研发对齐）

- **Store**：`src/stores/profile.store.ts`
- **API**：`src/api/profileApi.ts`、`src/api/browserApi.ts`、`src/api/settingsApi.ts`
- **关键 IPC（后端命令）**：
  - Profile：`get_profiles/get_profile/create_profile/update_profile/delete_profile/batch_delete_profiles`
  - Browser：`launch_browser/stop_browser/batch_launch_browsers/batch_stop_browsers`
  - Settings：`get_setting_value`（用于启动前校验）
- **事件（Tauri event）**：
  - `profile:status_changed`：用于实时更新状态
  - `browser:error`：用于启动失败提示与状态置 error

### 2.6 关键验收点

- 列表 CRUD：创建/编辑/删除后列表状态与 DB 一致。
- 启停：启动成功后状态变 running；停止后变 stopped；异常时变 error。
- 启动前校验：kernel_path 为空时，必须引导到设置页。
- 批量：
  - 基础：能完成“成功数量反馈”
  - 完整：能展示逐项失败原因（依赖 Gate-BE-Batch）
- 操作菜单：
  - 已实现项必须可用（启动/停止/编辑/删除）
  - 规划项需明确后端能力与安全策略后再开放（Cookie/书签/密码/清理缓存/随机指纹/窗口转移）

---

## 3. 核心栏目：创建窗口 / 编辑窗口（ProfileDrawer / 抽屉）

### 3.1 栏目定位

- **定位**：创建/编辑窗口（Profile）的主入口。
- **入口**：Dashboard “创建新窗口/编辑窗口”打开抽屉。
- **主要页面**：`src/features/profile-editor/ProfileDrawer.vue`（多步骤表单）。

### 3.2 五个栏目（步骤）与字段细节（产品定义）

> 当前代码中步骤标题已对齐为：
> 
> - 窗口信息
> - 基础设置
> - 高级指纹设置
> - 代理设置
> - 偏好设置

#### 3.2.1 栏目 1：窗口信息

- **窗口名称（必填）**：`name`
- **窗口 ID（系统生成，仅展示）**：`id`
  - 创建时由后端生成并返回；编辑时用于定位该窗口
  - 目标态：在“编辑窗口”时固定展示，并支持一键复制
- **自定义浏览器窗口名称（可选）**：`customWindowName`
  - 用途：用于浏览器窗口标题展示（具体生效规则需后端/启动参数落地）
- **分组（可选）**：`group`
  - 产品要求：以“分组选择器”选择 group（后端需提供 groups 列表）
- **Cookie（可选）**：`cookies`
  - 当前 UI 在“窗口信息”表单中已存在输入框
  - 建议：明确是“创建时导入 Cookie”还是“仅保存待后续导入”，并与“更多菜单-上传Cookie”能力区分
- **备注（可选）**：`remark`

#### 3.2.2 栏目 2：基础设置

> 当前 `useProfileForm.ts` 中的 `basicSettings` 默认结构：

- **语言**：`language`（auto/zh-CN/en-US 等）
  - 结构说明：当 language = custom 时，使用 `languageValue` 保存自定义值（例如：`zh-CN,en-US`）
- **显示语言**：`displayLanguage`
  - 结构说明：当 displayLanguage = custom 时，使用 `displayLanguageValue` 保存自定义值
- **时区**：`timezone`
  - 结构说明：当 timezone = custom 时，使用 `timezoneValue` 保存自定义时区字符串
- **地理位置请求策略**：`geolocationPrompt`（ask/allow/block）
- **地理位置**：`geolocation`（auto 或具体）
  - 结构说明：当 geolocation = custom 时，使用 `geolocationLatitude/geolocationLongitude`
- **媒体开关**：`audio/image/video`（boolean）
- **窗口大小策略**：`windowSize`（custom/…）
- **窗口宽高**：`windowWidth/windowHeight`

> 现状说明：以上字段在 `BasicSettingsForm.vue` 已有 UI 控件，属于“表单已完成”，但是否真正影响浏览器启动行为仍需后端落地。

#### 3.2.3 栏目 3：高级指纹设置

- **指纹对象**：`fingerprint`（JSON）
- **随机重置指纹（按钮）**：当前抽屉支持 `regenerateFingerprint()`
- **主要可配置项（按当前 UI）**：
  - 分辨率（resolution）
  - 字体（fonts）
  - WebRTC（webrtc/webrtcPublicIp/webrtcLocalIp）
  - WebGL（webglImage/webglVendor/webglRenderer）
  - WebGPU（webgpu）
  - Canvas（canvas）
  - AudioContext（audioContext）
  - SpeechVoices（speechVoices）
  - DoNotTrack（doNotTrack）
  - ClientRects（clientRects）
  - MediaDevices（mediaDevices）
- **安全策略（必须说明清楚）**：
  - 白名单：只允许可控字段写入
  - 黑名单：禁止注入启动参数/路径/调试端口等危险键
  - 编辑保存采用 patch（增量）提交，后端 merge（透传不丢）（Gate-FP）

#### 3.2.4 栏目 4：代理设置

- **代理对象**：`proxy`（JSON，可空）
- 产品要求的“代理信息”字段建议（需与后端/Proxy 模块统一）：
  - type（http/https/socks5/direct）
  - host/port
  - username/password（可选）
  - remark/source/tag（可选）

> 现状说明：当前 `ProxyForm.vue` 已实现的字段为：
>
> - enable switch（启用代理）
> - type（http/https/socks5）
> - host / port
> - username / password

#### 3.2.5 栏目 5：偏好设置

> 当前 `useProfileForm.ts` 中 `preferences` 默认结构较完整（boolean 开关为主），例如：

- **同步类**：syncBookmarks/syncHistory/syncTabs/syncCookies/syncExtensions/syncPasswords/syncIndexedDB/syncLocalStorage/syncSessionStorage
- **启动清理类**：clearCacheOnStart/clearCookiesOnStart/clearLocalStorageOnStart
- **指纹类**：randomFingerprintOnStart
- **浏览器提示**：showPasswordSavePrompt
- **异常策略**：stopOnNetworkError/stopOnIpChange/stopOnCountryChange/ipChangeNotification
- **工作台/登录类**：openWorkbench/enableGoogleLogin

> 说明：上述偏好设置要生效，最终都需要后端在启动参数/用户数据目录/扩展策略中落地。

### 3.3 关键交互规则（创建/编辑窗口）

- **步骤跳转规则**：
  - “窗口信息”未填写窗口名称时，不允许跳转到后续步骤
- **保存规则**：
  - 创建窗口：提交完整表单（含 fingerprint/basicSettings/preferences/proxy）
  - 编辑窗口：
    - 基础字段（name/group/remark）直接更新
    - 指纹字段按 patch 计算（增量）提交（后端需 merge 才能“透传不丢”）

### 3.4 依赖

- **API**：`profileApi`（create/update）
- **配置**：`src/config/fingerprint.config.ts`

### 3.5 验收点

- 创建窗口成功：返回列表可见，字段展示正确（名称/分组/平台/代理/备注/时间）。
- 编辑窗口成功：列表对应行更新，事件/状态不漂移。
- 指纹策略：
  - 白名单字段可正常保存
  - “透传不丢”验收依赖后端 merge：只改 timezone，未知字段不应丢失（Gate-FP）

---

## 4. 核心栏目：分组管理（Groups）

### 4.1 栏目定位

- **定位**：管理分组（Group），用于对窗口进行组织与筛选。
- **入口**：侧边栏“分组管理”。
- **主要页面**：`src/features/groups/GroupManagement.vue`。

### 4.2 主要功能点（UI 现状）

- 分组列表展示（名称/排序/窗口数/权限/创建时间）。
- 搜索、分页。
- 新增/编辑/删除分组（弹窗表单）。

### 4.3 当前实现状态（重要）

- 前端 Store 层存在 mock fallback（当后端 Group IPC 缺失或调用失败时会回退），因此当前版本“分组功能”可能仅为 UI 演示。
- 分组删除策略（禁止删除非空分组）在前端 store 有实现，但后端也需要强校验。

### 4.4 依赖

- **Store**：`src/stores/groupStore.ts`
- **API**：`src/api/groupApi.ts`
- **关键 IPC（后端命令）**：`get_groups/get_group/create_group/update_group/delete_group`（当前后端缺失，属 Gate）

### 4.5 验收点（需 Gate-BE-Group 解锁）

- 前端关闭 mock fallback 后仍可 CRUD。
- 删除非空分组被后端拒绝，前端能提示明确原因。
- Dashboard/编辑抽屉中可真实选择分组并按分组筛选。

---

## 5. 系统设置（Settings）

### 5.1 栏目定位

- **定位**：配置启动器运行所需的系统参数。
- **入口**：侧边栏“系统设置”。
- **主要页面**：`src/features/settings/SettingsView.vue`。

### 5.2 功能点

- **浏览器内核路径（必填）**：选择 chrome.exe 等。
- **用户数据目录（可选）**：选择目录。
- **默认代理（可选）**：字符串形式输入。
- **保存/重置**。

### 5.3 依赖

- **Dialog**：`@tauri-apps/plugin-dialog`
- **API/IPC**：`get_all_settings/set_setting_value/get_setting_value`

### 5.4 验收点

- 保存后重启应用仍能回显。
- kernel_path 未填不可保存。
- Dashboard 启动前检查能正确引导。

---

## 6. 回收站（RecycleBin）

### 6.1 栏目定位

- **定位**：展示被删除的窗口，并支持恢复/永久删除/清空。
- **入口**：侧边栏“回收站”。
- **主要页面**：`src/features/recycle/RecycleBin.vue`。

### 6.2 当前实现状态（重要）

- 页面代码中已明确标注“⏳ RecycleBin 功能已延期至 V3/V4”，当前 `loadData()` 直接返回空列表。

### 6.3 规划功能点（待实现）

- 列表展示（含分组筛选、搜索、分页、批量选择）。
- 恢复、永久删除、批量恢复、批量永久删除、清空回收站。

### 6.4 依赖（待实现）

- `recycleBinApi` + 后端对应 IPC 与数据模型（当前后端未实现）。

---

## 7. 代理管理（Proxy）

### 7.1 栏目定位

- **定位**：维护代理模板/代理池，供窗口启动时绑定使用。
- **入口**：侧边栏“代理”。
- **主要页面**：`src/features/proxy/ProxyManagement.vue`。

### 7.2 当前实现状态（重要）

- 页面代码中已明确标注“⏳ Proxy 功能已延期至 V3/V4”，当前 `loadProxies()` 直接返回空列表。

### 7.3 规划功能点（待实现）

- 代理列表（筛选：类型/来源/状态；搜索：host/ip）。
- 新增/编辑/删除代理。
- 代理有效性检测（可选）。
- 与 Profile 的绑定策略（默认代理/单 profile 代理）需要产品规则。

---

## 8. 标签管理（Tags）

### 8.1 栏目定位

- **定位**：标签体系，用于对窗口进行更灵活的分类（非树形分组）。
- **入口**：侧边栏“标签”。
- **主要页面**：`src/features/tags/TagManagement.vue`。

### 8.2 当前实现状态（重要）

- 页面代码中已明确标注“⏳ Tag 功能已延期至 V3/V4”，当前 `loadTags()` 直接返回空列表。

### 8.3 规划功能点（待实现）

- 标签 CRUD（排序、搜索、分页）。
- Profile 与 tags 的关联（多对多）及筛选逻辑（待后端支持）。

---

## 9. 窗口群控（Window Control）

### 9.1 栏目定位

- **定位**：对已运行的窗口进行统一布局与显隐控制（Windows 平台）。
- **入口（用户视角）**：通常挂在 Dashboard 的工具栏/更多操作中（具体 UI 入口以组件实现为准）。

### 9.2 功能点

- 宫格排列（arrange_windows_grid）
- 隐藏全部窗口（hide_all_windows）
- 显示全部窗口（show_all_windows）

### 9.3 依赖

- IPC：`arrange_windows_grid/hide_all_windows/show_all_windows`
- 后端依赖运行中进程 PID 列表与 Win32 窗口枚举。

### 9.4 风险与验收点

- 风险：误操作 DevTools/非主窗口；窗口未就绪导致偶发失败。
- 验收：至少 5 个运行窗口可稳定排列/隐藏/显示；失败时提示可理解。

---

## 10. 事件与状态同步（全局能力）

### 10.1 事件监听入口

- `src/services/eventListener.ts` 在应用启动时初始化（`src/main.ts` 调用）。

### 10.2 当前监听事件（前端侧）

- `profile:status_changed`：更新 profile 状态
- `profile:created`：插入列表并提示
- `profile:updated`：更新列表项
- `profile:deleted`：移除列表项并提示
- `browser:error`：将 profile 标记为 error 并 toast 提示

### 10.3 关键验收点

- 事件到达后 UI 状态最终一致（以事件为准）。
- 启动失败的错误信息可见且可定位到具体环境。

---

## 11. 当前版本“功能真/假”边界（给测试/产品）

- **真实可联调（当前可测）**：
  - 窗口列表（基础）/ 创建窗口 / 编辑窗口
  - 启动/停止（单个与批量基础能力）
  - Settings（kernel_path/user_data_dir/default_proxy）
  - 基础事件（profile:status_changed / browser:error 等）
- **受 Gate 阻塞（当前不可测/不可宣称交付）**：
  - Group 真联调（后端缺 IPC）
  - Fingerprint 透传不丢（后端 merge 未闭环）
  - 批量逐项失败原因（后端批量逐项结果未闭环）
  - “更多菜单”的窗口级能力（Cookie/书签/密码/清理缓存/随机指纹/窗口转移）
- **延期/演示**：Tags / Proxy / RecycleBin（页面存在但数据与后端未闭环）
