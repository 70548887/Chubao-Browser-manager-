# è§¦å®æŒ‡çº¹æµè§ˆå™¨ - é¡¹ç›®æ¶æ„è§„èŒƒ

> **è§’è‰²**ï¼šé¡¹ç›®æ¶æ„å¸ˆ
> **ç›®æ ‡**ï¼šå»ºç«‹ç»Ÿä¸€çš„å¼€å‘è§„èŒƒï¼Œé¿å…ä»£ç è…åŒ–ï¼Œæ”¯æŒå›¢é˜Ÿåä½œ

---

## 1. ç›®å½•ç»“æ„è§„èŒƒ

```
browser-manager/
â”œâ”€â”€ .vscode/                    # ç¼–è¾‘å™¨é…ç½®
â”‚   â””â”€â”€ settings.json           # ç»Ÿä¸€æ ¼å¼åŒ–è§„åˆ™
â”œâ”€â”€ docs/                       # ğŸ“š è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ planning/                   # ğŸ“‹ å¼€å‘è§„åˆ’
â”‚
â”œâ”€â”€ src/                        # ğŸ¨ Vue å‰ç«¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ api/                    # [L1] API å±‚ - Tauri IPC å°è£…
â”‚   â”‚   â”œâ”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ profile.api.ts      # ç¯å¢ƒç®¡ç† API
â”‚   â”‚   â”œâ”€â”€ browser.api.ts      # æµè§ˆå™¨æ§åˆ¶ API
â”‚   â”‚   â””â”€â”€ system.api.ts       # ç³»ç»Ÿè®¾ç½® API
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                 # [L0] é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ styles/             # å…¨å±€æ ·å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ main.scss       # å…¥å£æ ·å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ variables.scss  # CSS å˜é‡ (é¢œè‰²/é—´è·)
â”‚   â”‚   â”‚   â””â”€â”€ element-dark.scss
â”‚   â”‚   â”œâ”€â”€ icons/              # SVG å›¾æ ‡
â”‚   â”‚   â””â”€â”€ images/             # å›¾ç‰‡èµ„æº
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # [L2] é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/             # åŸå­ç»„ä»¶ (Button, Input, Badge)
â”‚   â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶ (Sidebar, Header)
â”‚   â”‚   â””â”€â”€ business/           # ä¸šåŠ¡ç»„ä»¶ (ProfileCard, StatusDot)
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/            # [L2] ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ useTheme.ts         # ä¸»é¢˜åˆ‡æ¢
â”‚   â”‚   â”œâ”€â”€ useBrowserStatus.ts # æµè§ˆå™¨çŠ¶æ€è®¢é˜…
â”‚   â”‚   â””â”€â”€ useVirtualScroll.ts # è™šæ‹Ÿæ»šåŠ¨
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                 # [L0] é…ç½®å¸¸é‡ (ç¦æ­¢ç¡¬ç¼–ç )
â”‚   â”‚   â”œâ”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ app.config.ts       # åº”ç”¨é…ç½®
â”‚   â”‚   â””â”€â”€ theme.config.ts     # ä¸»é¢˜é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ features/               # [L3] åŠŸèƒ½æ¨¡å— (æ ¸å¿ƒä¸šåŠ¡)
â”‚   â”‚   â”œâ”€â”€ dashboard/          # ä»ªè¡¨ç›˜æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ components/     # æ¨¡å—ç§æœ‰ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ composables/    # æ¨¡å—ç§æœ‰ hooks
â”‚   â”‚   â”‚   â””â”€â”€ DashboardView.vue
â”‚   â”‚   â”œâ”€â”€ fingerprint/        # æŒ‡çº¹é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ network/            # ç½‘ç»œä»£ç†æ¨¡å—
â”‚   â”‚   â””â”€â”€ settings/           # ç³»ç»Ÿè®¾ç½®æ¨¡å—
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/                # [L2] é¡µé¢å¸ƒå±€
â”‚   â”‚   â””â”€â”€ MainLayout.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                 # [L1] è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                 # [L1] çŠ¶æ€ç®¡ç† (Pinia)
â”‚   â”‚   â”œâ”€â”€ index.ts            # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ profile.store.ts    # ç¯å¢ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ app.store.ts        # å…¨å±€çŠ¶æ€
â”‚   â”‚   â””â”€â”€ types.ts            # Store ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                  # [L0] TypeScript ç±»å‹
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ profile.types.ts    # Profile ç›¸å…³ç±»å‹
â”‚   â”‚   â”œâ”€â”€ browser.types.ts    # Browser ç›¸å…³ç±»å‹
â”‚   â”‚   â””â”€â”€ api.types.ts        # API å“åº”ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # [L0] å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ format.ts           # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â””â”€â”€ validate.ts         # éªŒè¯å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue                 # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts                 # å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ src-tauri/                  # âš™ï¸ Rust åç«¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                # [L1] Tauri Commands (IPC æ¥å£)
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ profile_cmd.rs  # ç¯å¢ƒç®¡ç†å‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ browser_cmd.rs  # æµè§ˆå™¨æ§åˆ¶å‘½ä»¤
â”‚   â”‚   â”‚   â””â”€â”€ system_cmd.rs   # ç³»ç»Ÿå‘½ä»¤
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/               # [L2] æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/        # ç¯å¢ƒç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ browser/        # æµè§ˆå™¨å¯åŠ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ window/         # çª—å£æ§åˆ¶
â”‚   â”‚   â”‚   â””â”€â”€ proxy/          # ä»£ç†æ¡¥æ¥
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/     # [L0] åŸºç¡€è®¾æ–½
â”‚   â”‚   â”‚   â”œâ”€â”€ database/       # SQLite å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ logger/         # æ—¥å¿—é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ config/         # é…ç½®åŠ è½½
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/             # [L0] æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ profile.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ fingerprint.rs
â”‚   â”‚   â”‚   â””â”€â”€ proxy.rs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ error.rs            # ç»Ÿä¸€é”™è¯¯ç±»å‹
â”‚   â”‚   â”œâ”€â”€ lib.rs
â”‚   â”‚   â””â”€â”€ main.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ migrations/             # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ Cargo.toml
â”‚
â”œâ”€â”€ tests/                      # ğŸ§ª æµ‹è¯• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”œâ”€â”€ unit/                   # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ e2e/                    # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚
â””â”€â”€ package.json
```

---

## 2. å±‚çº§ä¾èµ–è§„åˆ™

```
L3 (Features) â†’ L2 (Components/Composables) â†’ L1 (API/Store/Router) â†’ L0 (Types/Utils/Config)
```

**è§„åˆ™**ï¼š
- ä¸Šå±‚å¯ä»¥ä¾èµ–ä¸‹å±‚
- åŒå±‚ä¹‹é—´ç¦æ­¢å¾ªç¯ä¾èµ–
- L0 å±‚ä¸ä¾èµ–ä»»ä½•å…¶ä»–å±‚

---

## 3. å‘½åè§„èŒƒ

### 3.1 æ–‡ä»¶å‘½å

| ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| Vue ç»„ä»¶ | PascalCase | `ProfileCard.vue` |
| TypeScript | camelCase | `profile.api.ts` |
| Store | camelCase + .store | `profile.store.ts` |
| Types | camelCase + .types | `profile.types.ts` |
| Rust æ¨¡å— | snake_case | `profile_cmd.rs` |

### 3.2 å˜é‡å‘½å

```typescript
// âœ… æ­£ç¡®
const profileList = ref<Profile[]>([])
const isLoading = ref(false)
const handleSubmit = () => {}

// âŒ é”™è¯¯
const list = ref([])           // ä¸æ˜ç¡®
const loading = ref(false)     // ç¼ºå°‘ is å‰ç¼€
const submit = () => {}        // ç¼ºå°‘ handle å‰ç¼€
```

### 3.3 ç»„ä»¶å‘½å

```vue
<!-- âœ… æ­£ç¡® -->
<ProfileCard />
<StatusBadge />
<AppSidebar />

<!-- âŒ é”™è¯¯ -->
<profile-card />  <!-- ä½¿ç”¨ PascalCase -->
<Card />          <!-- å¤ªæ³›åŒ–ï¼Œéœ€è¦å‰ç¼€ -->
```

---

## 4. Vue ç»„ä»¶è§„èŒƒ

### 4.1 ç»„ä»¶ç»“æ„

```vue
<script setup lang="ts">
// 1. å¯¼å…¥
import { ref, computed, onMounted } from 'vue'
import type { Profile } from '@/types'

// 2. Props & Emits
interface Props {
  profile: Profile
  isActive?: boolean
}
const props = withDefaults(defineProps<Props>(), {
  isActive: false
})
const emit = defineEmits<{
  (e: 'update', value: Profile): void
  (e: 'delete', id: string): void
}>()

// 3. å“åº”å¼çŠ¶æ€
const isEditing = ref(false)

// 4. è®¡ç®—å±æ€§
const statusText = computed(() => 
  props.isActive ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'
)

// 5. æ–¹æ³•
const handleEdit = () => {
  isEditing.value = true
}

// 6. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  // åˆå§‹åŒ–é€»è¾‘
})
</script>

<template>
  <!-- å•æ ¹å…ƒç´  -->
  <div class="profile-card">
    <!-- æ¨¡æ¿å†…å®¹ -->
  </div>
</template>

<style scoped lang="scss">
.profile-card {
  // æ ·å¼
}
</style>
```

### 4.2 ç»„ä»¶åˆ†ç±»

| ç±»å‹ | ä½ç½® | ç‰¹ç‚¹ |
|------|------|------|
| åŸå­ç»„ä»¶ | `components/common/` | æ— ä¸šåŠ¡é€»è¾‘ï¼Œçº¯å±•ç¤º |
| ä¸šåŠ¡ç»„ä»¶ | `components/business/` | åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œå¯å¤ç”¨ |
| é¡µé¢ç»„ä»¶ | `features/*/` | æ¨¡å—çº§åˆ«ï¼Œç»„åˆç»„ä»¶ |

---

## 5. çŠ¶æ€ç®¡ç†è§„èŒƒ (Pinia)

```typescript
// stores/profile.store.ts
import { defineStore } from 'pinia'
import type { Profile } from '@/types'
import { ProfileApi } from '@/api'

export const useProfileStore = defineStore('profile', {
  state: () => ({
    profiles: [] as Profile[],
    currentProfile: null as Profile | null,
    isLoading: false,
    error: null as string | null,
  }),

  getters: {
    runningProfiles: (state) => 
      state.profiles.filter(p => p.status === 'running'),
    
    profileCount: (state) => state.profiles.length,
  },

  actions: {
    async fetchProfiles() {
      this.isLoading = true
      this.error = null
      try {
        this.profiles = await ProfileApi.getList()
      } catch (e) {
        this.error = (e as Error).message
      } finally {
        this.isLoading = false
      }
    },
  },

  persist: true, // æŒä¹…åŒ–
})
```

---

## 6. API å±‚è§„èŒƒ

### 6.1 IPC æ¥å£æ–‡æ¡£çº¦å®š

- **æ¥å£æ¥æº**ï¼šæ‰€æœ‰ Tauri IPCï¼ˆ`invoke`ï¼‰å‘½ä»¤çš„åç§°ã€å‚æ•°åï¼ˆå¤§å°å†™ï¼‰ã€è¿”å›å€¼ä¸é”™è¯¯çº¦å®šï¼Œå¿…é¡»ä»¥ `docs/IPC-æ¥å£è¯´æ˜.md` ä¸ºå‡†ã€‚
- **æ–°å¢/å˜æ›´è§„åˆ™**ï¼šå½“æ–°å¢æˆ–ä¿®æ”¹ Rust ç«¯ `tauri::command`ï¼ˆåŒ…æ‹¬å‘½ä»¤åã€å‚æ•°åã€è¿”å›ç»“æ„ã€é”™è¯¯ä¿¡æ¯ï¼‰æ—¶ï¼Œå¿…é¡»åŒæ­¥æ›´æ–° `docs/IPC-æ¥å£è¯´æ˜.md`ï¼Œå¹¶ç¡®ä¿å‰ç«¯ `src/api/*` çš„å°è£…ä¸ä¹‹ä¿æŒä¸€è‡´ã€‚

```typescript
// api/profile.api.ts
import { invoke } from '@tauri-apps/api/core'
import type { Profile, CreateProfileDTO } from '@/types'

export const ProfileApi = {
  async getList(): Promise<Profile[]> {
    return invoke('get_profiles')
  },

  async create(data: CreateProfileDTO): Promise<Profile> {
    return invoke('create_profile', { data })
  },

  async delete(id: string): Promise<void> {
    return invoke('delete_profile', { id })
  },
}
```

---

## 7. Rust è§„èŒƒ

### 7.1 é”™è¯¯å¤„ç†

```rust
// error.rs
use thiserror::Error;

#[derive(Error, Debug)]
pub enum AppError {
    #[error("æ•°æ®åº“é”™è¯¯: {0}")]
    Database(#[from] sqlx::Error),
    
    #[error("é…ç½®ä¸å­˜åœ¨: {0}")]
    ProfileNotFound(String),
    
    #[error("æµè§ˆå™¨å¯åŠ¨å¤±è´¥: {0}")]
    BrowserLaunchFailed(String),
}

// ä½¿ç”¨
fn get_profile(id: &str) -> Result<Profile, AppError> {
    // ...
}
```

### 7.2 Tauri Command

```rust
// api/profile_cmd.rs
use tauri::command;
use crate::core::profile::ProfileService;
use crate::error::AppError;

#[command]
pub async fn get_profiles() -> Result<Vec<Profile>, String> {
    ProfileService::get_all()
        .await
        .map_err(|e| e.to_string())
}
```

---

## 8. ç¦æ­¢äº‹é¡¹ (Code Smell)

| âŒ ç¦æ­¢ | âœ… æ›¿ä»£æ–¹æ¡ˆ |
|--------|----------|
| ç¡¬ç¼–ç  URL | ä½¿ç”¨ `config/` |
| ç¡¬ç¼–ç é¢œè‰² | ä½¿ç”¨ CSS å˜é‡ |
| any ç±»å‹ | å®šä¹‰å…·ä½“ interface |
| console.log (ç”Ÿäº§) | ä½¿ç”¨ logger |
| ä¸­æ–‡å˜é‡å | è‹±æ–‡ + æ³¨é‡Š |
| è¶…è¿‡ 300 è¡Œçš„æ–‡ä»¶ | æ‹†åˆ†æ¨¡å— |
| å¾ªç¯ä¾èµ– | é‡æ„å±‚çº§ |

---

## 9. Git æäº¤è§„èŒƒ

```
<type>(<scope>): <subject>

feat(profile): æ·»åŠ ç¯å¢ƒæ‰¹é‡åˆ é™¤åŠŸèƒ½
fix(proxy): ä¿®å¤ä»£ç†è¿æ¥è¶…æ—¶é—®é¢˜
refactor(ui): é‡æ„ä¾§è¾¹æ ç»„ä»¶
docs: æ›´æ–°å¼€å‘è§„èŒƒæ–‡æ¡£
style: æ ¼å¼åŒ–ä»£ç 
test: æ·»åŠ  Profile Store å•å…ƒæµ‹è¯•
```
