# 项目架构设计 - 触宝指纹浏览器 (Chubao Fingerprint Browser)

## 1. 系统概览 (System Overview)
本系统基于 **Rust + Tauri 2.0** 构建，采用 **“指挥官-士兵” (Commander-Soldier)** 架构，旨在提供大厂级的指纹浏览器多开解决方案。

*   **Commander (主控端)**: `browser-manager` (Rust Process)，负责资源调度、代理转发、UI 交互。
*   **Soldier (执行端)**: 自研魔改 Chromium 146 (Sub-Process)，基于 Google 开源浏览器深度定制，负责底层渲染、指纹伪装、脚本执行。

## 2. 功能模块设计 (Functional Modules)

### 2.1 核心业务层 (Core Business Layer) - Rust
*   **Profile Manager (环境管理器)**
    *   **职责**: 管理浏览器配置文件 (Profile)。每个 Profile 对应一个唯一的 SQLite 记录和磁盘目录。
    *   **特性**: 支持从云端拉取配置，支持本地 CRUD。
*   **Fingerprint Engine (指纹引擎)**
    *   **职责**: 生成高拟真的指纹参数 (Canvas Noise, WebGL Vendor, Audio Context)。
    *   **算法**: 基于 Seed 的确定性随机算法，保证同一 Environment ID 每次生成的指纹一致。
*   **Proxy Bridge (代理网桥)**
    *   **职责**: 解决 Chromium 原生不支持带密码 SOCKS5 的问题。
    *   **实现**: Rust 开启本地 TCP Listener (127.0.0.1:Random)，将流量转发至远程代理。
    *   **安全**: 实现“断网熔断”机制，代理连接失败立即切断 Socket。

### 2.2 基础设施层 (Infrastructure Layer)
*   **Process Supervisor (进程监控)**
    *   负责 Chromium 子进程的保活、心跳检测 (Heartbeat) 和僵尸进程清理。
*   **Storage Service (存储服务)**
    *   封装 `sqlx`，提供对 `profiles.db` 的异步访问。提供 Migration 自动迁移功能。
*   **Window Manager (窗口管理)**
    *   利用 `windows-rs` 操控 HWND，实现指纹浏览器的排版（宫格）、置顶、老板键（一键隐藏）。

## 3. UI 模块设计 (UI Modules) - Vue 3

### 3.1 视觉层 (Visual Layer)
*   **UI 框架**: Element Plus (原生组件库，支持深色模式)
*   **样式系统**: Tailwind CSS 4.x + SCSS (组件级样式)
*   **Layouts**: `MainLayout` (自定义标题栏 + 侧边栏 + 主内容区)

### 3.2 交互层 (Interaction Layer)
*   **Store (Pinia)**:
    *   `ProfileStore`: 缓存当前页面展示的环境列表。
    *   `AppStore`: 管理全局 Loading、Toast、侧边栏折叠状态。
*   **Composables**:
    *   `useBrowserStatus`: 实时订阅 Rust 端推送的浏览器运行状态。
    *   `useVirtualScroll`: 处理 1000+ 环境列表的高性能渲染。

## 4. 日志与监控模块 (Logging & Monitoring)

### 4.1 日志系统
*   **Rust**: 使用 `tracing` + `tracing-appender`。
    *   日志文件路径: `logs/app.log` (按天滚动，自动压缩)。
    *   控制台输出: 开发模式下开启 `debug` 级别，生产环境 `info` 级别。
*   **Crash Report**: 捕获 Panic 和不可恢复错误，下次启动时上报。

### 4.2 性能监控
*   实时监控 CPU/内存占用率，若系统负载过高，自动限制并发启动数量（流控）。

## 5. 测试模块 (Testing Strategy)

### 5.1 单元测试 (Unit Tests)
*   **Rust**: `cargo test` 覆盖核心算法（指纹生成、密码加密、JSON 解析）。
*   **Frontend**: `Vitest` 测试核心组件（状态转换、Props 传递）。

### 5.2 集成测试 (Integration Tests)
*   **Proxy Test**: 模拟代理服务器，验证 Proxy Bridge 的转发正确性。
*   **Database Test**: 验证 SQLite 的 CRUD 和 Migration。
*   **Fingerprint Test**: 启动浏览器访问检测网站 (如 ip-api)，验证指纹参数是否生效。

## 6. 安全架构
*   **配置加密**: 敏感信息 (代理密码、Cookies) 使用 AES-256-GCM 加密存储在 SQLite。
*   **IPC 安全**: Tauri 命令启用 Isolation 模式，防止前端 XSS 攻击 Backend。
