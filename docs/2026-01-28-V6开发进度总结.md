# V6 开发进度总结（当前项目进度快照）

**日期**：2026-01-28  
**范围**：`browser-manager`（Launcher：Vue3 + Tauri2 + Rust + SQLite）  
**说明**：本总结以当前代码为准，辅助参考 `docs/` 中的 V4/V5 总结与计划文档。

---

## 1. 总体结论

- **核心主链路（窗口管理）已具备闭环联调能力**：窗口 CRUD、启动/停止、批量操作结果、分组管理、设置校验、进程监控与事件。
- **V5 扩展模块（Tag / RecycleBin / Proxy）后端 IPC 已解锁并接入**，前端页面已具备真实 API 调用，但部分页面仍存在“字段对齐/模拟逻辑未替换”的收尾工作。
- 当前交付风险主要集中在：
  - **ProxyManagement/RecycleBin 页面与最新 DTO 字段对齐**（避免继续使用临时字段/模拟检测）
  - **TypeScript build 仍可能失败**（已在 V4 总结中提示 Fingerprint/ProfileDrawer 类型问题）
  - **Group 字段语义一致性**（前端 Profile.group 与后端 profiles.group_id 的映射策略需确认）

---

## 2. 模块完成度（按“可联调闭环”口径）

### 2.1 前端（Vue）

- **主框架/导航（App + Layout）**：✅ 完成
  - `src/App.vue`：页面切换 `dashboard/groups/recycle/proxy/tags/settings`
- **Dashboard（窗口列表）**：✅ 基本完成
  - `src/features/dashboard/DashboardView.vue`
  - 搜索/筛选/排序/分页/批量启停/批量删除
  - 启动前校验 `kernel_path`，未设置引导到 Settings
  - 批量失败展示：`src/components/BatchResultDialog.vue`
- **ProfileDrawer（创建/编辑 5 栏目）**：✅ 基本完成
  - 结合 `src/features/profile-editor/*` 及表单组件
- **Settings（系统设置）**：✅ 基本完成（至少 kernel_path 相关链路可用）
- **Groups（分组管理）**：✅ 基本完成
- **Tags（标签管理）**：✅ 页面/API 就绪
  - `src/features/tags/TagManagement.vue` + `src/api/tagApi.ts`
- **RecycleBin（回收站）**：🟡 页面/API 就绪，需字段对齐收尾
  - `src/api/recycleBinApi.ts` 已读取 `deleted_at -> deletedAt`
  - `src/features/recycle/RecycleBin.vue` 仍存在“删除时间”口径需切换到 `deletedAt`（避免继续用 `updatedAt`）
- **ProxyManagement（代理列表）**：🟡 页面/API 就绪，需替换模拟检测与假字段
  - `src/api/proxyApi.ts` 已支持 `testProxy()`
  - `src/features/proxy/ProxyManagement.vue` 仍有 `handleCheck` 模拟检测、以及“模板转 Proxy”假字段填充

### 2.2 后端（Rust/Tauri）

- **DB/迁移**：✅ 完成
  - `src-tauri/migrations/001_init.sql`
  - `src-tauri/migrations/002_add_groups.sql`
  - `src-tauri/migrations/003_add_tags_and_recycle.sql`
  - `src-tauri/migrations/004_add_proxies.sql`
- **Profile（窗口）**：✅ 完成（含软删除）
  - `src-tauri/src/modules/profile/service.rs`：主列表 `WHERE deleted_at IS NULL`，删除为写 `deleted_at`
- **Browser 启停/批量 + 进程监控**：✅ 完成
  - IPC：`launch_browser/stop_browser/batch_launch_browsers/batch_stop_browsers`
  - `BrowserLauncher`：支持 user-data-dir、proxy-server、remote-debugging-port
  - `BrowserManager`：限流、监控退出回写 DB、事件 `profile:status_changed` / `browser:error`
- **Groups（分组）**：✅ 完成（带 profileCount、删除策略）
- **Tags（标签）**：✅ Service 已实现 + IPC 已接入
  - `src-tauri/src/modules/tag.rs`
- **RecycleBin（回收站）**：✅ Service 已实现 + IPC 已接入
  - `src-tauri/src/modules/recycle_bin.rs` 已返回 `deleted_at`
- **Proxy（代理表版本）**：✅ Service 已实现 + IPC 已接入
  - `src-tauri/src/modules/proxy.rs`
  - IPC 注册包含 `test_proxy`

---

## 3. 当前“可运行链路”

### 3.1 可直接冒烟的端到端链路（建议优先验证）

- **Settings**：设置 `kernel_path`
- **窗口 CRUD**：创建/编辑/删除（删除应进入回收站：软删除）
- **启停**：单个启动/停止
- **批量**：批量启动/停止/删除，失败项能在 BatchResultDialog 展示
- **分组**：分组 CRUD + 删除策略（非空禁止删除）
- **标签/回收站/代理**：后端命令已接入，可开始真实联调

---

## 4. 关键证据（以代码为准）

- **V5 解锁（Tag/RecycleBin/Proxy 接入）**：
  - `src-tauri/src/lib.rs`（`AppState` 初始化：TagService/RecycleBinService/ProxyService）
  - `src-tauri/src/lib.rs`（invoke_handler 注册：get_tags/get_recycle_bin/get_proxies/test_proxy 等）
- **Proxy 升级为表结构**：
  - `src-tauri/migrations/004_add_proxies.sql`
  - `src-tauri/src/modules/proxy.rs`
- **RecycleBin 已返回 deleted_at**：
  - `src-tauri/src/modules/recycle_bin.rs`
  - 前端 `src/api/recycleBinApi.ts`：`deleted_at -> deletedAt`

---

## 5. 当前剩余工作（按优先级）

### P0（当天可完成，直接提升“可验收”）

- **RecycleBin 页面字段对齐**：
  - `RecycleBin.vue` 中“删除时间”改用 `profile.deletedAt`（来自 API），不再使用 `updatedAt`
- **ProxyManagement 接入真实检测**：
  - `handleCheck` 改为调用 `proxyApi.testProxy(proxy.id)`
  - 将结果（success/latency/error/ip/location）映射到 UI
- **ProxyManagement 去掉假字段填充**：
  - 移除 `templateToProxy` 的“模拟字段”，直接使用后端返回的 ProxyDto->Proxy

### P1（1-2 天，避免后续联调反复）

- **Group 语义统一**：
  - 需要确认前端 Profile 的 `group` 表示 `groupId` 还是 `groupName`
  - 当前后端 GroupService 使用 `profiles.group_id` 聚合；前端筛选与显示要与此一致

### P2（用于“可交付 build”）

- **修复 TypeScript build 错误**：
  - `npm run build` 需通过（V4 总结提到 FingerprintForm/ProfileDrawer 类型问题）

---

## 6. 建议排期（单人前端 + 单人后端已完成大部分时）

- **0.5 天**：RecycleBin/Proxy 页面字段对齐 + Proxy 检测接入
- **0.5-1 天**：Group 语义统一（Profile.group 与 group_id）+ 联调回归
- **0.5-1 天**：清理 TS build 错误（保证可打包）

合计：**1.5-3 天** 可达到“可验收 + 可 build”。

---

## 7. 下一步建议的冒烟清单（手工即可）

- [ ] 设置 kernel_path
- [ ] 创建窗口 → 启动 → 停止
- [ ] 批量启动/停止（制造 1 个失败，看 BatchResultDialog）
- [ ] 删除窗口 → 回收站出现 → 恢复 → 回到列表
- [ ] 新增代理 → 检测代理（成功/失败）→ 编辑 → 删除
- [ ] 标签：新增/编辑/删除，windowCount 正常显示
